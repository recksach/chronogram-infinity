<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHRONOGRAM: ARMOR</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gun/sea.js"></script>

    <style>
        /* === ARMOR STYLE === */
        :root {
            --bg: #000;
            --gold: #D4AF37;
            --glass: rgba(20, 20, 20, 0.95);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Montserrat'; height: 100vh; overflow: hidden; }
        
        /* –§–û–ù (–û–ø—É—â–µ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–∏–∑–∫–æ) */
        #matrix { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; opacity:0.3; pointer-events: none; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .app-layout { display: flex; height: 100%; width: 100%; position: relative; z-index: 1; }
        
        /* –ú–ï–ù–Æ */
        .sidebar { width: 70px; background: #080808; border-right: 1px solid #333; display: flex; flex-direction: column; align-items: center; padding-top: 20px; z-index: 500; }
        .nav-item { font-size: 1.8rem; margin-bottom: 30px; cursor: pointer; color: #555; transition: 0.2s; position: relative; z-index: 501; }
        .nav-item.active { color: var(--gold); transform: scale(1.2); text-shadow: 0 0 10px var(--gold); }

        @media (max-width: 768px) {
            .app-layout { flex-direction: column; }
            .sidebar { width: 100%; height: 60px; flex-direction: row; justify-content: space-around; border-right: none; border-top: 1px solid #333; position: absolute; bottom: 0; padding: 0; order: 2; }
            .nav-item { margin-bottom: 0; }
            .main { order: 1; height: calc(100% - 60px) !important; }
        }

        .main { flex: 1; background: var(--glass); display: flex; flex-direction: column; position: relative; height: 100%; z-index: 2; }
        .top-bar { height: 60px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; flex-shrink: 0; }
        .brand { font-family: 'Cinzel'; color: var(--gold); font-weight: bold; font-size: 1.2rem; }

        .page { flex: 1; overflow-y: auto; padding: 15px; display: none; flex-direction: column; align-items: center; padding-bottom: 80px; position: relative; z-index: 5; }
        .page.active { display: flex; }
        .container { width: 100%; max-width: 500px; }

        /* –ö–ù–û–ü–ö–ò (–°–£–ü–ï–† –í–ê–ñ–ù–û: z-index –≤—ã—Å–æ–∫–∏–π) */
        .btn { 
            background: linear-gradient(135deg, #bf953f, #fcf6ba, #b38728); 
            border: none; padding: 12px 20px; border-radius: 25px; 
            font-weight: bold; cursor: pointer !important; color: #000; font-family: 'Cinzel'; 
            width: 100%; margin-top: 10px; position: relative; z-index: 1000;
            box-shadow: 0 0 10px rgba(212,175,55,0.3);
        }
        .btn:active { transform: scale(0.95); background: #fff; } /* –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
        
        input, textarea { width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 10px; margin-bottom: 10px; font-family: 'Montserrat'; font-size: 1rem; position: relative; z-index: 1000; }
        
        .card { background: rgba(30,30,30,0.8); border: 1px solid #444; border-radius: 15px; padding: 15px; margin-bottom: 15px; position: relative; width: 100%; z-index: 10; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--gold); background-size: cover; background-position: center; background-color: #000; flex-shrink: 0; cursor: pointer; position: relative; z-index: 1000; }

        /* –í–•–û–î */
        #auth-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        
        .hidden { display: none !important; }
        
        /* –°–ø–µ—Ü—ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è Mrakodum */
        .god-mode { border: 2px solid var(--gold) !important; box-shadow: 0 0 20px var(--gold); }
        .badge { color: var(--gold); margin-left: 5px; text-shadow: 0 0 5px var(--gold); }
    </style>
</head>
<body>

    <canvas id="matrix"></canvas>

    <div id="auth-screen">
        <div style="width:120px; height:120px; border-radius:50%; border:3px solid #D4AF37; margin-bottom:30px; background-image:url('image_1.png'); background-size:cover;"></div>
        <h1 style="font-family:'Cinzel'; color:#D4AF37;">CHRONOGRAM</h1>
        <div style="width: 280px; text-align: center;">
            <input type="text" id="auth-user" placeholder="–õ–æ–≥–∏–Ω (mrakodum)" style="text-align:center;">
            <input type="password" id="auth-pass" placeholder="–ü–∞—Ä–æ–ª—å" style="text-align:center;">
            <div style="display:flex; gap:10px;">
                <button class="btn" style="background:#333; color:white;" onclick="Auth.reg()">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                <button class="btn" onclick="Auth.login()">–í–û–ô–¢–ò</button>
            </div>
            <br>
            <button onclick="localStorage.clear(); sessionStorage.clear(); location.reload();" style="background:transparent; border:none; color:red; font-size:0.7rem; cursor:pointer; text-decoration:underline; position:relative; z-index:10000;">–°–ë–†–û–°–ò–¢–¨ –ó–ê–í–ò–°–ê–ù–ò–ï</button>
        </div>
    </div>

    <div id="app-ui" class="app-layout hidden">
        <div class="sidebar">
            <div class="nav-item active" onclick="Nav.go('feed')">‚ò∑</div>
            <div class="nav-item" onclick="Nav.go('search')">üîç</div>
            <div class="nav-item" onclick="Nav.go('aura')" style="color:#e056fd;">‚óé</div>
            <div class="nav-item" onclick="Nav.go('chats')">üí¨</div>
            <div class="nav-item" onclick="Nav.go('profile')">üë§</div>
        </div>

        <div class="main">
            <div class="top-bar">
                <span class="brand">GLOBAL</span>
                <div class="avatar" id="head-ava" style="width:40px; height:40px;" onclick="Nav.go('profile')"></div>
            </div>

            <div id="pg-feed" class="page active">
                <div class="container">
                    <div class="card">
                        <textarea id="post-text" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
                        <button class="btn" onclick="Feed.post()">–û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨</button>
                    </div>
                    <div id="feed-list"></div>
                </div>
            </div>

            <div id="pg-search" class="page">
                <div class="container">
                    <input type="text" id="search-inp" placeholder="–ü–æ–∏—Å–∫ –Ω–∏–∫–∞...">
                    <button class="btn" onclick="Search.run()">–ù–ê–ô–¢–ò</button>
                    <div id="search-res"></div>
                </div>
            </div>

            <div id="pg-aura" class="page">
                <div class="container">
                    <label class="btn" style="display:block; text-align:center;">
                        + –ó–ê–ì–†–£–ó–ò–¢–¨ –í–ò–î–ï–û/–§–û–¢–û
                        <input type="file" hidden accept="video/*,image/*" onchange="Aura.upload(this)">
                    </label>
                    <div id="aura-feed" style="margin-top:20px;"></div>
                </div>
            </div>

            <div id="pg-chats" class="page">
                <div class="container">
                    <h3>–í–ê–®–ò –î–ò–ê–õ–û–ì–ò</h3>
                    <div id="chat-list"></div>
                </div>
            </div>

            <div id="pg-profile" class="page">
                <div class="container">
                    <div class="card" style="text-align:center;">
                        <label>
                            <div class="avatar" id="profile-ava" style="width:100px; height:100px; margin:0 auto;"></div>
                            <input type="file" hidden accept="image/*" onchange="Profile.upload(this)">
                        </label>
                        <h2 id="profile-name" style="color:#D4AF37; margin-top:10px;">@User</h2>
                        
                        <div id="god-controls" class="hidden" style="border:1px solid red; padding:10px; margin-top:10px; border-radius:10px;">
                            <h4 style="color:red; margin:0;">GOD MODE</h4>
                            <input type="text" id="god-target" placeholder="–ù–∏–∫ –∂–µ—Ä—Ç–≤—ã">
                            <button class="btn" style="background:#500;" onclick="God.verify()">–í–´–î–ê–¢–¨ –ì–ê–õ–û–ß–ö–£</button>
                            <button class="btn" style="background:#800;" onclick="God.ban()">–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–¢–¨</button>
                        </div>

                        <button class="btn" style="background:#333;" onclick="Auth.logout()">–í–´–ô–¢–ò</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="chat-room" class="page" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:2000; display:none;">
        <div class="top-bar">
            <span id="chat-partner" style="color:var(--gold);">User</span>
            <button class="btn" style="width:auto; padding:5px 10px; margin:0;" onclick="document.getElementById('chat-room').style.display='none'">X</button>
        </div>
        <div id="chat-msgs" style="flex:1; overflow-y:auto; padding:20px; padding-bottom:80px;"></div>
        <div style="position:absolute; bottom:0; left:0; width:100%; padding:10px; background:#111;">
            <input type="text" id="chat-msg-inp" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <button class="btn" onclick="Chat.send()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
        </div>
    </div>

    <script>
        const gun = Gun(['https://gun-manhattan.herokuapp.com/gun', 'https://gun-eu.herokuapp.com/gun']);
        const user = gun.user();
        let myUser = null;

        // === AUTH ===
        const Auth = {
            reg: () => {
                const u = document.getElementById('auth-user').value.toLowerCase();
                const p = document.getElementById('auth-pass').value;
                if(!u || !p) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è");
                user.create(u, p, ack => {
                    if(ack.err) alert(ack.err);
                    else Auth.login();
                });
            },
            login: () => {
                const u = document.getElementById('auth-user').value.toLowerCase();
                const p = document.getElementById('auth-pass').value;
                user.auth(u, p, ack => {
                    if(ack.err) alert(ack.err);
                    else {
                        myUser = u;
                        document.getElementById('auth-screen').style.display = 'none';
                        document.getElementById('app-ui').classList.remove('hidden');
                        App.start();
                    }
                });
            },
            logout: () => {
                user.leave();
                location.reload();
            }
        };

        gun.on('auth', () => {
            user.get('alias').once(u => {
                myUser = u;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-ui').classList.remove('hidden');
                App.start();
            });
        });

        // === APP ===
        const App = {
            start: () => {
                // –ï—Å–ª–∏ —Ç—ã –ú—Ä–∞–∫–æ–¥—É–º - –≤–∫–ª—é—á–∞–µ–º –∞–¥–º–∏–Ω–∫—É –°–†–ê–ó–£
                if(myUser === 'mrakodum') {
                    document.getElementById('god-controls').classList.remove('hidden');
                    document.getElementById('profile-name').innerHTML += ' <span class="badge">‚ôõ</span>';
                }
                
                Profile.load();
                Feed.init();
                Aura.init();
                Chat.load();
            }
        };

        // === PROFILE ===
        const Profile = {
            load: () => {
                document.getElementById('profile-name').innerText = '@' + myUser;
                user.get('avatar').on(src => {
                    if(src) {
                        document.getElementById('profile-ava').style.backgroundImage = `url('${src}')`;
                        document.getElementById('head-ava').style.backgroundImage = `url('${src}')`;
                    }
                });
            },
            upload: (inp) => {
                const f = inp.files[0];
                const r = new FileReader();
                r.onload = (e) => user.get('avatar').put(e.target.result);
                r.readAsDataURL(f);
            }
        };

        // === FEED ===
        const Feed = {
            post: () => {
                const txt = document.getElementById('post-text').value;
                if(!txt) return;
                gun.get('posts_new').set({
                    text: txt, author: myUser, time: Date.now()
                });
                document.getElementById('post-text').value = '';
            },
            init: () => {
                gun.get('posts_new').map().once(p => {
                    if(!p) return;
                    document.getElementById('feed-list').insertAdjacentHTML('afterbegin', 
                        `<div class="card">
                            <b style="color:#D4AF37">@${p.author}</b>
                            <p>${p.text}</p>
                        </div>`
                    );
                });
            }
        };

        // === AURA ===
        const Aura = {
            upload: (inp) => {
                const f = inp.files[0];
                const r = new FileReader();
                r.onload = (e) => {
                    gun.get('aura_new').set({
                        src: e.target.result, author: myUser, time: Date.now()
                    });
                    alert("–ó–∞–≥—Ä—É–∂–µ–Ω–æ!");
                };
                r.readAsDataURL(f);
            },
            init: () => {
                gun.get('aura_new').map().once(p => {
                    if(!p) return;
                    let content = p.src.includes('data:video') 
                        ? `<video src="${p.src}" controls style="width:100%"></video>`
                        : `<img src="${p.src}" style="width:100%">`;
                    
                    document.getElementById('aura-feed').insertAdjacentHTML('afterbegin', 
                        `<div class="card">
                            <b style="color:#D4AF37">@${p.author}</b><br>
                            ${content}
                        </div>`
                    );
                });
            }
        };

        // === SEARCH ===
        const Search = {
            run: () => {
                const q = document.getElementById('search-inp').value.toLowerCase();
                // –ü–æ–∏—Å–∫ –≤ Gun —Å–ª–æ–∂–Ω—ã–π, –¥–µ–ª–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –Ω–∏–∫–∞
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —é–∑–µ—Ä–æ–≤
                gun.get('users_index').get(q).once(pub => {
                    const res = document.getElementById('search-res');
                    res.innerHTML = '';
                    if(pub) {
                        res.innerHTML = `
                        <div class="card">
                            <h3>${q}</h3>
                            <button class="btn" onclick="Chat.open('${pub}', '${q}')">–ù–ê–ü–ò–°–ê–¢–¨</button>
                        </div>`;
                    } else {
                        res.innerHTML = "–ù–µ –Ω–∞–π–¥–µ–Ω (—é–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–π—Ç–∏ –≤ —Å–µ—Ç—å —Ö–æ—Ç—å —Ä–∞–∑)";
                    }
                });
            }
        };
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–µ–±—è –≤ –∏–Ω–¥–µ–∫—Å–µ
        gun.on('auth', () => {
            gun.get('users_index').get(myUser).put(user.is.pub);
        });

        // === CHAT ===
        const Chat = {
            currentPub: null,
            load: () => {
                user.get('chats').map().once((val, pub) => {
                    gun.user(pub).get('alias').once(name => {
                        document.getElementById('chat-list').innerHTML += 
                            `<div class="card" onclick="Chat.open('${pub}','${name}')" style="cursor:pointer;">
                                <b>${name}</b>
                            </div>`;
                    });
                });
            },
            open: (pub, name) => {
                Chat.currentPub = pub;
                document.getElementById('chat-room').style.display = 'block';
                document.getElementById('chat-partner').innerText = name;
                document.getElementById('chat-msgs').innerHTML = '';
                
                // –ö–ª—é—á —á–∞—Ç–∞
                const k = [user.is.pub, pub].sort().join('_');
                gun.get('chat_new_' + k).map().once(m => {
                    const div = document.createElement('div');
                    div.style.background = m.sender === myUser ? '#D4AF37' : '#333';
                    div.style.color = m.sender === myUser ? '#000' : '#fff';
                    div.style.padding = '10px';
                    div.style.margin = '5px';
                    div.style.borderRadius = '10px';
                    div.innerText = m.text;
                    document.getElementById('chat-msgs').appendChild(div);
                });
            },
            send: () => {
                const txt = document.getElementById('chat-msg-inp').value;
                if(!txt) return;
                const k = [user.is.pub, Chat.currentPub].sort().join('_');
                gun.get('chat_new_' + k).set({
                    text: txt, sender: myUser, time: Date.now()
                });
                user.get('chats').get(Chat.currentPub).put(true); // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
                document.getElementById('chat-msg-inp').value = '';
            }
        };

        // === GOD MODE ===
        const God = {
            verify: () => {
                const t = document.getElementById('god-target').value;
                alert(`–ì–∞–ª–æ—á–∫–∞ –≤—ã–¥–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${t} (–í–∏–∑—É–∞–ª—å–Ω–æ)`);
            },
            ban: () => alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")
        };

        // === NAV ===
        const Nav = {
            go: (id) => {
                document.querySelectorAll('.page').forEach(e => e.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
                document.getElementById('pg-'+id).classList.add('active');
            }
        };

        // === MATRIX BG ===
        const cvs = document.getElementById('matrix'), ctx = cvs.getContext('2d');
        cvs.width = window.innerWidth; cvs.height = window.innerHeight;
        const p = Array(Math.floor(cvs.width/20)).fill(0);
        setInterval(() => {
            ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.fillRect(0,0,cvs.width,cvs.height);
            ctx.fillStyle = '#D4AF37';
            p.forEach((y, i) => {
                ctx.fillText(String.fromCharCode(0x30A0+Math.random()*96), i*20, y);
                p[i] = y > 100 + Math.random()*1e4 ? 0 : y + 20;
            });
        }, 50);
    </script>
</body>
</html>
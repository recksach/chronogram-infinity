<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#17212b">
    <title>CHRONOGRAM</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        /* === THEME: NFT REVOLUTION === */
        :root {
            --bg: #0f0f0f;
            --panel: #17212b;
            --accent: #5288c1;
            --gold: #FFD700;
            --ton: #0098EA;
            --text: #f5f5f5;
            --rare: #007aff;
            --epic: #a020f0;
            --leg: #ff4500;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Manrope', sans-serif; color: var(--text); background: #000; height: 100vh; overflow: hidden; }

        #app { display: none; width: 100%; height: 100%; display: flex; }
        #app.active { display: flex; }
        #auth-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--panel); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }

        .left-panel { width: 380px; background: var(--panel); border-right: 1px solid #000; display: flex; flex-direction: column; z-index: 10; }
        .right-panel { flex: 1; background: #000; background-image: url('https://w0.peakpx.com/wallpaper/508/153/HD-wallpaper-whatsapp-doodle-black-pattern.jpg'); background-size: cover; position: relative; display: flex; flex-direction: column; }

        @media (max-width: 768px) {
            .left-panel { width: 100%; }
            .right-panel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; transform: translateX(100%); transition: transform 0.25s ease; z-index: 20; }
            .right-panel.open { transform: translateX(0); }
        }

        /* UI ELEMENTS */
        .header { height: 60px; padding: 0 15px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.2); }
        .search { width: 90%; background: #242f3d; border: none; padding: 10px; border-radius: 8px; color: white; margin: 10px auto; display: block; }
        
        .list-item { display: flex; align-items: center; gap: 12px; padding: 10px 15px; cursor: pointer; }
        .list-item:hover { background: #202b36; }
        .ava { width: 48px; height: 48px; border-radius: 14px; background: linear-gradient(135deg, #4facfe, #00f2fe); display: flex; justify-content: center; align-items: center; font-weight: 800; font-size: 1.4rem; color: white; }
        .ava-chan { background: linear-gradient(135deg, var(--gold), orange); color: black; }

        /* CHAT */
        .chat-msgs { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 75%; padding: 10px; border-radius: 12px; font-size: 0.95rem; }
        .msg.me { align-self: flex-end; background: #2b5278; }
        .msg.other { align-self: flex-start; background: #182533; }
        
        .post { width: 100%; max-width: 480px; align-self: center; background: var(--panel); border-radius: 12px; padding: 15px; margin-bottom: 10px; }
        .cheat-btn { color: #0f0; font-size: 0.7rem; cursor: pointer; background: rgba(0,255,0,0.1); padding: 2px 6px; border-radius: 4px; margin-left: 5px; }

        /* NFT STYLES */
        .gift-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; max-height: 250px; overflow-y: auto; }
        .gift-card { 
            background: rgba(255,255,255,0.05); border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; position: relative; border: 1px solid transparent; 
            transition: all 0.2s;
        }
        
        /* RARITY EFFECTS */
        .rare-common { border-color: #555; }
        .rare-rare { border-color: var(--rare); box-shadow: 0 0 10px rgba(0,122,255,0.3); background: linear-gradient(135deg, rgba(0,122,255,0.1), transparent); }
        .rare-epic { border-color: var(--epic); box-shadow: 0 0 15px rgba(160,32,240,0.4); background: linear-gradient(45deg, rgba(160,32,240,0.2), rgba(0,0,0,0)); animation: pulse-epic 3s infinite; }
        .rare-legendary { 
            border-color: var(--leg); box-shadow: 0 0 20px rgba(255,69,0,0.6); 
            background: url('https://i.gifer.com/7SSp.gif'), linear-gradient(135deg, #ff4500, #ffcc00); 
            background-blend-mode: overlay; background-size: cover; color: white !important;
            animation: shake 5s infinite;
        }

        @keyframes pulse-epic { 0% { box-shadow: 0 0 5px var(--epic); } 50% { box-shadow: 0 0 20px var(--epic); } 100% { box-shadow: 0 0 5px var(--epic); } }
        @keyframes shake { 0% { transform: translate(0,0); } 2% { transform: translate(1px,1px); } 4% { transform: translate(-1px,-1px); } 100% { transform: translate(0,0); } }

        .gift-emoji { font-size: 2.5rem; }
        .gift-meta { font-size: 0.7rem; margin-top: 5px; opacity: 0.8; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; display: none; justify-content: center; align-items: center; }
        .modal-box { width: 360px; background: var(--panel); border-radius: 16px; overflow: hidden; padding: 20px; text-align: center; }
        
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-gold { background: linear-gradient(135deg, #FFD700, #FFA500); color: black; }
        .btn-ton { background: var(--ton); color: white; }
        .btn-sec { background: transparent; border: 1px solid var(--accent); color: var(--accent); }
        .btn-craft { background: linear-gradient(45deg, #ff00cc, #333399); color: white; }

        .app-input { width: 100%; padding: 12px; background: #0e1621; border: 1px solid #333; color: white; border-radius: 8px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div style="width:100px; height:100px; background:url('logo.jpg'); background-size:cover; border-radius:20px; margin-bottom:20px;"></div>
        <input id="email-in" class="app-input" placeholder="Email" style="width:250px;">
        <input id="password-in" class="app-input" type="password" placeholder="Password" style="width:250px;">
        <input id="username-in" class="app-input" placeholder="Username" style="width:250px;">
        <button class="btn btn-gold" style="width:250px;" onclick="Auth.login()">LOGIN</button>
        <button class="btn btn-sec" style="width:250px;" onclick="Auth.reg()">REGISTER</button>
    </div>

    <div id="app">
        <div class="left-panel">
            <div class="header">
                <span class="material-symbols-rounded" onclick="Profile.openMe()">menu</span>
                <b>CHRONOGRAM</b>
                <span class="material-symbols-rounded" onclick="Channels.createModal()">add_circle</span>
            </div>
            <input class="search" placeholder="Search..." oninput="Search.run(this.value)">
            <div style="flex:1; overflow-y:auto;" id="list-chats"></div>
            <div id="god-panel" class="hidden" style="padding:10px; background:#222;">
                <small style="color:var(--gold)">GOD MODE</small>
                <button class="btn btn-sec" onclick="Support.toggle()">üì® Requests</button>
                <button class="btn btn-gold" onclick="God.addCoins()">+1M Coins (Self)</button>
            </div>
        </div>
        <div class="right-panel" id="right-panel">
            <div id="empty-state" style="height:100%; display:flex; align-items:center; justify-content:center; color:#777;">Select Chat</div>
            <div id="chat-ui" class="hidden" style="height:100%; display:flex; flex-direction:column;">
                <div class="header" onclick="Profile.openOther()">
                    <div id="chat-ava" class="ava"></div>
                    <div style="margin-left:10px; flex:1;">
                        <b id="chat-name">Name</b><br>
                        <small id="chat-status">Online</small>
                    </div>
                    <button id="accept-btn" class="hidden btn btn-gold" style="width:auto; padding:5px 15px;" onclick="event.stopPropagation(); Support.accept()">ACCEPT</button>
                </div>
                <div id="chat-msgs" class="chat-msgs"></div>
                <div id="input-area" class="header" style="border-top:1px solid #000;">
                    <input id="msg-in" class="search" style="margin:0; width:100%;" placeholder="Message...">
                    <span class="material-symbols-rounded" style="color:var(--accent); margin-left:10px; cursor:pointer;" onclick="Chat.send()">send</span>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-profile" class="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-box">
            <div id="prof-ava" class="ava" style="width:80px; height:80px; margin:0 auto; font-size:2rem;"></div>
            <h2 id="prof-name">Name</h2>
            <div id="prof-tag" style="color:#777;">@tag</div>
            
            <div style="display:flex; justify-content:center; gap:20px; margin:15px 0;">
                <div><b id="prof-subs">0</b> <span class="cheat-btn hidden" id="cheat-sub" onclick="God.cheat('sub')">[+]</span><br><small>Subs</small></div>
                <div><b id="prof-views">0</b><br><small>Views</small></div>
            </div>

            <div id="my-wallet-btn" class="hidden">
                <button class="btn btn-gold" onclick="Wallet.open()">üí∞ WALLET / COINS</button>
            </div>

            <div style="text-align:left; margin-top:10px; color:#aaa;">NFT Collection:</div>
            <div id="prof-gifts" class="gift-grid"></div>

            <div id="prof-actions"></div>
        </div>
    </div>

    <div id="modal-wallet" class="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-box" style="background:linear-gradient(135deg, #0077b6, #0096c7); color:white;">
            <h2>TON WALLET</h2>
            <div style="font-size:2rem; font-weight:800;"><span id="wal-bal">0</span> CG</div>
            <small>1 TON ‚âà 25 CG</small>
            <div style="background:rgba(0,0,0,0.3); padding:10px; border-radius:8px; margin:15px 0; font-size:0.8rem; word-break:break-all;">
                DEPOSIT ADDRESS:<br><b id="admin-wallet">...</b>
                <br><br>
                REQUIRED MEMO:<br><b id="my-memo" style="color:var(--gold); font-size:1.2rem;">...</b>
            </div>
            <button class="btn btn-gold" onclick="Wallet.check()">Check Deposit (Simulate)</button>
            <button class="btn btn-sec" style="color:white; border-color:white;" onclick="Premium.buy()">Buy Premium (625 CG)</button>
        </div>
    </div>

    <div id="modal-shop" class="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-box">
            <h3>NFT Shop</h3>
            <div class="gift-grid">
                <div class="gift-card" onclick="Shop.buy('üç¶', 25)">üç¶<br>25</div>
                <div class="gift-card" onclick="Shop.buy('‚≠êÔ∏è', 50)">‚≠êÔ∏è<br>50</div>
                <div class="gift-card" onclick="Shop.buy('üíé', 100)">üíé<br>100</div>
                <div class="gift-card" onclick="Shop.buy('üëë', 500)">üëë<br>500</div>
                <div class="gift-card" onclick="Shop.buy('ü¶Ñ', 1000)">ü¶Ñ<br>1K</div>
                <div class="gift-card" onclick="Shop.buy('ü™ê', 5000)">ü™ê<br>5K</div>
            </div>
        </div>
    </div>

    <div id="modal-nft" class="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-box">
            <h3 id="nft-icon" style="font-size:4rem; margin:0;"></h3>
            <div id="nft-hash" style="font-family:monospace; color:#accent; font-size:0.7rem;"></div>
            <div id="nft-rarity" style="margin:10px; font-weight:bold;"></div>
            <div id="nft-price" style="color:#777;"></div>
            
            <button class="btn btn-craft" onclick="Shop.craft()">‚ú® CRAFT / UPGRADE (50 CG)</button>
            <button class="btn btn-gold" onclick="Shop.sell()">üí∞ SELL TO MARKET</button>
        </div>
    </div>

    <div id="modal-create" class="modal" onclick="if(event.target===this)this.style.display='none'">
        <div class="modal-box">
            <h3>New Channel</h3>
            <input id="new-ch-name" class="app-input" placeholder="Name">
            <input id="new-ch-slug" class="app-input" placeholder="@username">
            <button class="btn btn-gold" onclick="Channels.create()">CREATE</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCEHTgXvVF7a-H_NxlRj77i46ueelJBGL0",
            authDomain: "chronogramnew.firebaseapp.com",
            projectId: "chronogramnew",
            storageBucket: "chronogramnew.firebasestorage.app",
            messagingSenderId: "1081606850128",
            appId: "1:1081606850128:web:439fd598a3d11576a47355"
        };
        const ADMIN_WALLET = "UQALTzK2cJsUI7LUe85V82Et4Kmayzk11l_noMRvYCRa0_zQ";

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let me = null, isGod = false, isSupport = false, activeChat = null, profTarget = null, selectedNFT = null;
        const GODS = ['mrakodum', 'support_agent'];

        auth.onAuthStateChanged(u => {
            if(u) {
                me = u;
                db.collection('users').doc(u.uid).get().then(d => {
                    if(d.exists) {
                        me.d = d.data();
                        if(GODS.includes(me.d.username)) { isGod=true; document.getElementById('god-panel').classList.remove('hidden'); }
                        if(me.d.username === 'support_agent') { isSupport=true; }
                        document.getElementById('auth-screen').style.display='none';
                        App.init();
                    } else auth.signOut();
                });
            } else document.getElementById('auth-screen').style.display='flex';
        });

        const Auth = {
            login: () => auth.signInWithEmailAndPassword(document.getElementById('email-in').value, document.getElementById('password-in').value),
            reg: () => {
                const un = document.getElementById('username-in').value.toLowerCase();
                auth.createUserWithEmailAndPassword(document.getElementById('email-in').value, document.getElementById('password-in').value)
                .then(c => db.collection('users').doc(c.user.uid).set({
                    username: un, displayName: un, balance: 0, gifts: [], verified: GODS.includes(un), followers: [], following: []
                }));
            }
        };

        const App = { init: () => { Chats.load(); Channels.load(); } };

        const Chats = {
            load: () => {
                db.collection('users').doc(me.uid).collection('chats').orderBy('time','desc').onSnapshot(s => {
                    const l = document.getElementById('list-chats'); l.innerHTML='';
                    s.forEach(async doc => {
                        const d = doc.data();
                        if(isGod && d.isRequest && !d.accepted) return; // God hides requests from main list
                        const u = await db.collection('users').doc(doc.id).get();
                        const name = (d.isRequest && !isSupport) ? 'Support' : u.data().displayName;
                        l.innerHTML += `<div class="list-item" onclick="Chat.open('${doc.id}','user','${name}')"><div class="ava">${name[0]}</div><div style="margin-left:10px;"><b>${name}</b><br><small>${d.lastMsg}</small></div></div>`;
                    });
                });
            },
            open: (id, type, name) => {
                activeChat = {id, type};
                document.getElementById('right-panel').classList.add('open');
                document.getElementById('chat-ui').classList.remove('hidden');
                document.getElementById('empty-state').classList.add('hidden');
                document.getElementById('chat-name').innerText = name;
                document.getElementById('chat-ava').innerText = name[0];
                document.getElementById('chat-ava').className = type==='channel' ? 'ava ava-chan' : 'ava';
                
                document.getElementById('accept-btn').classList.add('hidden');
                document.getElementById('input-area').style.display = 'flex';

                if(type === 'channel') {
                    db.collection('channels').doc(id).onSnapshot(d => {
                        const c = d.data();
                        const realS = c.subs.length + (c.fakeSubs||0);
                        document.getElementById('chat-status').innerText = `${realS} Subs`;
                        if(c.owner !== me.uid && !isGod) document.getElementById('input-area').style.display='none';
                        if(isGod) document.getElementById('input-area').style.display='flex';
                    });
                } else {
                    db.collection('users').doc(me.uid).collection('chats').doc(id).get().then(d => {
                        if(d.exists && d.data().isRequest && !d.data().accepted) {
                            if(isSupport) document.getElementById('accept-btn').classList.remove('hidden');
                            else document.getElementById('input-area').style.display='none';
                        }
                    });
                }

                const col = type==='user'?'messages':'posts';
                const docId = type==='user'?[me.uid, id].sort().join('_'):id;
                db.collection(col).doc(docId).collection('msg').orderBy('time').onSnapshot(s => {
                    const d = document.getElementById('chat-msgs'); d.innerHTML='';
                    s.forEach(doc => {
                        const m = doc.data();
                        if(type==='channel') {
                            const cheat = isGod ? `<span class="cheat-btn" onclick="God.cheatView('${doc.id}')">[+50]</span>` : '';
                            d.innerHTML += `<div class="post">${m.text}<div style="margin-top:10px;color:#777;font-size:0.8rem;">üëÅ ${m.views||0} ${cheat}</div></div>`;
                            if(!isGod) doc.ref.update({views: firebase.firestore.FieldValue.increment(1)}); // Live view logic
                        } else {
                            d.innerHTML += `<div class="msg ${m.uid===me.uid?'me':'other'}">${m.text}</div>`;
                        }
                    });
                    d.scrollTop = d.scrollHeight;
                });
            },
            send: () => {
                const txt = document.getElementById('msg-in').value;
                if(!txt) return;
                const col = activeChat.type==='user'?'messages':'posts';
                const docId = activeChat.type==='user'?[me.uid, activeChat.id].sort().join('_'):activeChat.id;
                db.collection(col).doc(docId).collection('msg').add({text:txt, uid:me.uid, time:Date.now(), views:0});
                
                if(activeChat.type==='user') {
                    // Logic for new DM request omitted for brevity but standard firebase
                    db.collection('users').doc(me.uid).collection('chats').doc(activeChat.id).set({lastMsg:txt, time:Date.now()}, {merge:true});
                    db.collection('users').doc(activeChat.id).collection('chats').doc(me.uid).set({lastMsg:txt, time:Date.now(), unread:true}, {merge:true});
                }
                document.getElementById('msg-in').value='';
            }
        };

        const Channels = {
            createModal: () => document.getElementById('modal-create').style.display='flex',
            create: () => {
                const n = document.getElementById('new-ch-name').value;
                if(n) db.collection('channels').add({name:n, owner:me.uid, subs:[me.uid], fakeSubs:0}).then(()=>document.getElementById('modal-create').style.display='none');
            },
            load: () => {
                db.collection('channels').where('subs','array-contains',me.uid).onSnapshot(s => {
                    s.forEach(d => {
                        const l = document.getElementById('list-chats');
                        l.innerHTML += `<div class="list-item" onclick="Chat.open('${d.id}','channel','${d.data().name}')"><div class="ava ava-chan">${d.data().name[0]}</div><div style="margin-left:10px;"><b>${d.data().name}</b></div></div>`;
                    });
                });
            }
        };

        const Profile = {
            openMe: () => Profile.render(me.uid, 'user'),
            openOther: () => Profile.render(activeChat.id, activeChat.type),
            render: (id, type) => {
                profTarget = {id, type};
                document.getElementById('modal-profile').style.display='flex';
                const ref = type==='user'?db.collection('users').doc(id):db.collection('channels').doc(id);
                ref.onSnapshot(d => {
                    const data = d.data();
                    const realS = (data.followers?.length||data.subs?.length||0) + (data.fakeSubs||0);
                    document.getElementById('prof-name').innerText = data.displayName || data.name;
                    document.getElementById('prof-subs').innerText = realS;
                    
                    if(id === me.uid) document.getElementById('my-wallet-btn').classList.remove('hidden');
                    else document.getElementById('my-wallet-btn').classList.add('hidden');

                    if(isGod && type==='channel') document.getElementById('cheat-sub').classList.remove('hidden');
                    else document.getElementById('cheat-sub').classList.add('hidden');

                    const gGrid = document.getElementById('prof-gifts'); gGrid.innerHTML='';
                    if(data.gifts) data.gifts.forEach((g, i) => {
                        gGrid.innerHTML += `<div class="gift-card rare-${g.rarity?.toLowerCase()||'common'}" onclick="Shop.openDetail('${id}', ${i})">${g.icon}</div>`;
                    });

                    const acts = document.getElementById('prof-actions');
                    if(id !== me.uid) {
                        const isSub = type==='user' ? data.followers?.includes(me.uid) : data.subs?.includes(me.uid);
                        acts.innerHTML = `<button class="btn btn-sec" onclick="Profile.sub('${id}','${type}',${isSub})">${isSub?'Unsub':'Sub'}</button>`;
                        if(type==='user') acts.innerHTML += `<button class="btn btn-gold" onclick="document.getElementById('modal-gift-shop').style.display='flex'">Send Gift</button>`;
                    } else {
                        acts.innerHTML = `<button class="btn btn-sec" onclick="auth.signOut()">Logout</button>`;
                    }
                });
            },
            sub: (id, type, isSub) => {
                const op = isSub ? firebase.firestore.FieldValue.arrayRemove(me.uid) : firebase.firestore.FieldValue.arrayUnion(me.uid);
                if(type==='channel') db.collection('channels').doc(id).update({subs:op});
                else db.collection('users').doc(id).update({followers:op});
            }
        };

        const Wallet = {
            open: () => {
                document.getElementById('modal-wallet').style.display='flex';
                document.getElementById('wal-bal').innerText = me.d.balance;
                document.getElementById('admin-wallet').innerText = ADMIN_WALLET;
                document.getElementById('my-memo').innerText = me.uid;
            },
            check: () => {
                if(confirm(`Did you send TON to ${ADMIN_WALLET} with comment ${me.uid}?`)) {
                    // In real app, backend checks blockchain. Here we simulate for prototype or notify support.
                    alert("Scanning Blockchain... Funds will appear shortly.");
                    // For demo: add 100 coins
                    // db.collection('users').doc(me.uid).update({balance: firebase.firestore.FieldValue.increment(100)});
                }
            }
        };

        const Shop = {
            buy: (icon, price) => {
                if(me.d.balance < price) return alert('No money');
                const nft = {
                    icon, price, 
                    hash: 'NFT-'+Math.random().toString(36).substr(2,9), 
                    rarity: 'Common',
                    owner: profileTarget?.id || me.uid
                };
                // Deduct from me
                db.collection('users').doc(me.uid).update({balance: me.d.balance - price});
                // Add to target
                const targetRef = db.collection('users').doc(profileTarget?.id || me.uid);
                targetRef.update({gifts: firebase.firestore.FieldValue.arrayUnion(nft)});
                alert('Gift Sent/Bought!');
            },
            openDetail: (uid, idx) => {
                db.collection('users').doc(uid).get().then(d => {
                    const g = d.data().gifts[idx];
                    selectedNFT = {uid, idx, ...g};
                    document.getElementById('modal-nft').style.display='flex';
                    document.getElementById('nft-icon').innerText = g.icon;
                    document.getElementById('nft-hash').innerText = g.hash;
                    document.getElementById('nft-rarity').innerText = g.rarity;
                    document.getElementById('nft-rarity').className = `rare-${g.rarity.toLowerCase()}`;
                });
            },
            craft: () => {
                if(me.d.balance < 50) return alert('Need 50 CG');
                db.collection('users').doc(me.uid).get().then(doc => {
                    const gifts = doc.data().gifts;
                    const r = Math.random();
                    let newR = 'Rare';
                    if(r > 0.6) newR = 'Epic';
                    if(r > 0.9) newR = 'Legendary';
                    
                    gifts[selectedNFT.idx].rarity = newR;
                    db.collection('users').doc(me.uid).update({gifts: gifts, balance: me.d.balance - 50});
                    alert(`Upgraded to ${newR}!`);
                    document.getElementById('modal-nft').style.display='none';
                });
            },
            sell: () => {
                db.collection('users').doc(me.uid).get().then(doc => {
                    let gifts = doc.data().gifts;
                    gifts.splice(selectedNFT.idx, 1); // Remove
                    const sellPrice = Math.floor(selectedNFT.price * 0.9);
                    db.collection('users').doc(me.uid).update({gifts: gifts, balance: me.d.balance + sellPrice});
                    alert(`Sold for ${sellPrice} CG`);
                    document.getElementById('modal-nft').style.display='none';
                });
            }
        };

        const God = {
            selfBalance: () => db.collection('users').doc(me.uid).update({balance: firebase.firestore.FieldValue.increment(1000000)}),
            cheat: (t) => db.collection('channels').doc(profTarget.id).update({fakeSubs: firebase.firestore.FieldValue.increment(100)}),
            cheatView: (pid) => db.collection('posts').doc(activeChat.id).collection('msg').doc(pid).update({views: firebase.firestore.FieldValue.increment(50)})
        };

        const Support = {
            toggle: () => {
                document.getElementById('right-panel').classList.add('open');
                // Support logic simplified: just load pending requests
                db.collection('users').doc(me.uid).collection('chats').where('isRequest','==',true).get().then(s => {
                    // Logic to list requests...
                });
            }
        };
        
        const Search = {
            run: (v) => {
                // Search logic (User + Channel)
            }
        };
    </script>
</body>
</html>